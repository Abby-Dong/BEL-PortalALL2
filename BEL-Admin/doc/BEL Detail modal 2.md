# BEL 詳細資訊彈窗 (`#bel-details-modal`)

本文件闡述 BEL 管理平台中 BEL (品牌推廣者) 詳細資訊彈窗的功能與結構。

## 總覽

BEL 詳細資訊彈窗提供單一 BEL 的個人資料、績效、財務資訊和管理選項的綜合檢視。當使用者在 BEL 管理面板的表格中點擊 BEL 的推薦 ID 時，此彈窗便會顯示。

此彈窗在 HTML 中的 ID 為 `#bel-details-modal`。

## 功能

彈窗分為左右兩個主要區塊：左側為詳細資訊面板，右側為管理與筆記面板。

### 標頭 (Header)

-   **BEL 姓名與等級**: 顯示 BEL 的全名及其目前的等級徽章（例如，Exploder、Leader）。
-   **識別資訊**: 顯示 BEL 的推薦 ID 和電子郵件地址。
-   **頭像**: BEL 個人資料圖片的預留位置。
-   **關閉按鈕**: 允許使用者關閉彈窗。

### 左側面板 (分頁導覽)

此區塊使用分頁來組織 BEL 的詳細資訊。

1.  **績效分頁 (`#overview`)**
    -   **總體指標**: 一組卡片，顯示關鍵績效指標 (KPI)：
        -   總點擊數
        -   總訂單數
        -   總營收
        -   轉換率
        -   平均訂單價值 (AOV)
    -   **績效趨勢圖**: 一個折線圖，視覺化過去 6 個月的績效趨勢。
    -   **個人績效細分**: 一個圖表，按特定指標細分績效。

2.  **財務分頁 (`#payouts`)**
    -   **銀行資訊**: 顯示 BEL 用於接收款項的銀行詳細資料。
        -   銀行名稱
        -   SWIFT 代碼
        -   帳戶持有人姓名
        -   電話號碼
        -   地址
    -   **操作**:
        -   `編輯`: 允許管理員更新資訊。
        -   `歷史紀錄`: 點擊 `#banking-history-btn` 按鈕後，系統會顯示一個彈窗，其中包含該 BEL 銀行資訊的所有歷史變更紀錄。這有助於追蹤修改歷史，確保財務安全與合規性。每筆紀錄應包含：
            -   **修改日期**
            -   **修改者** (例如，管理者姓名或 ID)
            -   **修改的欄位**
            -   **修改前的值**
            -   **修改後的值**

3.  **付款分頁 (`#payout`)**
    -   **摘要卡片**: 顯示迄今為止的總付款金額和待付款金額。
    -   **近期付款歷史**: 一個表格，列出近期的付款交易。

4.  **客戶洞察分頁 (`#insights`)**
    -   **熱門購買類別**: 顯示 BEL 推薦的顧客最常購買的產品類別。
    -   **前 10 名產品**: 透過 BEL 推薦購買的前 10 名產品列表。

### 右側面板 (管理與筆記)

此區塊用於內部管理目的。

1.  **管理**
    -   **調整等級**: 一個下拉式選單，用於變更 BEL 的等級。
    -   **儲存變更**: 一個按鈕儲存變更。

2.  **內部筆記 (稽核軌跡)**
    -   **筆記歷史**: 與 BEL 相關的內部筆記的時間順序日誌。每條筆記包括內容和時間戳。
    -   **新增筆記**: 一個文字區域和按鈕，用於向稽核軌跡新增筆記。

## 互動式彈窗與邏輯 (IT 參考)

#### 1. 彈窗觸發與資料載入
- **觸發事件**: 管理者在 BEL 管理面板的表格中點擊任一 BEL 的「推薦 ID」。
- **介面行為**:
    - 系統顯示一個覆蓋層 (overlay) 和 `#bel-details-modal` 彈窗。
    - 資料成功載入後，彈窗內容（如姓名、績效指標、銀行資訊等）被填充。
- **錯誤處理**: 如果資料載入失敗，彈窗應顯示一則錯誤訊息，並提供一個「重試」或「關閉」的選項。

#### 2. 銀行資訊編輯模式
- **觸發事件**: 點擊「財務」分頁中的「編輯」按鈕 (`#edit-banking-btn`)。
- **介面行為**:
    - 對應的輸入欄位 (`input.banking-edit`, `textarea.banking-edit`) 變為可見。
    - 「編輯」和「歷史紀錄」按鈕被隱藏，取而代之的是「儲存變更」和「取消」按鈕 (`div.banking-edit-actions`)。
- **取消編輯**: 點擊「取消」按鈕 (`#cancel-banking-btn`) 會恢復到原始的唯讀狀態，所有變更都會被捨棄。
- **儲存變更**:
    - 點擊「儲存變更」按鈕 (`#save-banking-btn`) 後，系統會先彈出一個確認對話框，要求管理者進行二次確認。
    - **對話框內容**:
        - **標題**: 「確認修改銀行資訊」
        - **警告訊息**: 「此操作將直接影響未來的款項支付，請謹慎操作。」
        - **確認選項 (Checkbox)**: `[ ] 我已核對並確認所有變更的正確性。`
        - **變更原因 (Textarea)**: 一個必填的文字輸入框，要求管理者說明變更原因。
    - **判斷邏輯**:
        - 「確認修改」按鈕預設為禁用狀態。
        - 只有當管理者勾選「確認選項」並填寫「變更原因」後，按鈕才會啟用。
        - 若管理者點擊「確認修改」，則觸發前端資料驗證（驗證銀行資訊格式）。
        - 驗證成功後，向後端發送更新請求（包含變更原因）。成功後，介面返回唯讀模式，並顯示更新後的資料。
        - 如果儲存失敗，會顯示錯誤訊息，介面保持在編輯模式。
        - 若管理者點擊「取消」，則對話框關閉，介面繼續保持在編輯模式。

#### 3. 新增內部筆記
- **觸發事件**: 在 `#add-note-textarea` 中輸入內容後，點擊「新增筆記」按鈕 (`#add-note-btn`)。
- **介面行為**:
    - 點擊後，按鈕應顯示為禁用狀態，以防止重複提交。
    - 向後端發送新增筆記的請求。
    - 成功後，新的筆記會被添加到「筆記歷史」列表的頂部，文字區域被清空，按鈕恢復正常狀態。

#### 4. 等級調整與權益變更確認
- **觸發事件**: 管理者在右側「管理」區塊調整 BEL 等級後，點擊「儲存變更」按鈕。
- **介面行為**:
    - 系統會彈出一個確認對話框。
    - **對話框內容**: 「您確定要調整此 BEL 的等級嗎？此操作將影響其佣金率和相關權益。」
    - **選項**: 提供「確認變更」與「取消」兩個按鈕。
- **判斷邏輯**:
    - 若管理者點擊「取消」，則對話框關閉，等級不會變更。
    - 若管理者點擊「確認變更」，系統才會向後端發送更新請求，並在成功後顯示成功訊息。
- **用意**: 這是一個重要的防呆機制，確保管理者在執行影響 BEL 權益的敏感操作前，能再次確認其意圖，避免誤操作。

## 資料來源

- BEL 的個人詳細資料、績效指標、財務和客戶洞察資料預計來自一個或多個 JSON 檔案，例如 `data/bel-details/{BEL_ID}.json` 或一個包含所有 BEL 資料的大型檔案。
- 內部筆記的讀取與寫入需要與後端 API 進行互動。