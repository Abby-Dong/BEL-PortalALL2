<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Announcement Delete Functionality</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="BEL-Admin/src/css/main.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>System Announcements Delete Functionality Test</h1>
        
        <!-- System Announcements Panel -->
        <div class="bel-panel" id="announcements-panel" style="margin-top: 20px;">
            <div class="panel-header">
                <h3 style="margin:0;">System Announcements</h3>
                <button class="bel-btn primary" id="send-announcement-btn-new">
                    <i class="fas fa-bullhorn"></i> Send Announcement
                </button>
            </div>
            <div class="scrollable-table-container">
                <table class="bel-table" id="announcements-table">
                    <thead>
                        <tr>
                            <th data-sortable data-type="string">Created</th>
                            <th data-sortable data-type="string">Level</th>
                            <th data-sortable data-type="string">Title</th>
                            <th data-sortable data-type="string">Body</th>
                            <th data-sortable data-type="string">Link</th>
                            <th>Delete</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="test-result">
            <h3>Test Instructions:</h3>
            <p>1. The table should display announcements with Delete buttons in the rightmost column</p>
            <p>2. Click a Delete button to test the confirmation modal</p>
            <p>3. The delete button should have the class "bel-btn-s danger" and include a trash icon</p>
            <p>4. After deletion, the announcement should be removed from the table</p>
        </div>
    </div>

    <!-- Load test data and functionality -->
    <script src="BEL-Admin/src/js/data-loader.js"></script>
    <script>
        // Mock APP_DATA for testing
        window.APP_DATA = {
            announcements: {
                announcements: [
                    {
                        created: "2025-08-26",
                        category: "Leader",
                        title: "Urgent System Alert",
                        body: "Critical security update required",
                        link: "https://example.com/security-update"
                    },
                    {
                        created: "2025-08-25",
                        category: "Exploder",
                        title: "Platform Maintenance",
                        body: "Scheduled maintenance on September 1st",
                        link: "https://example.com/maintenance"
                    },
                    {
                        created: "2025-08-20",
                        category: "Enabler",
                        title: "New ADAM Series Available",
                        body: "Latest ADAM series now available for promotion",
                        link: "https://example.com/adam-series"
                    }
                ]
            }
        };

        // Mock ContentManager functionality for testing
        const TestContentManager = {
            announcementConfirmModalEl: null,
            currentModalZIndex: 2000,

            getNextModalZIndex() {
                this.currentModalZIndex += 10;
                return this.currentModalZIndex;
            },

            getCategoryBadgeClass(category) {
                switch (category) {
                    case 'Builder':
                        return 'builder';
                    case 'Enabler':
                        return 'enabler';
                    case 'Exploder':
                        return 'exploder';
                    case 'Leader':
                        return 'leader';
                    default:
                        return '';
                }
            },

            renderAnnouncementsNew() {
                const tableBody = document.querySelector('#announcements-table tbody');
                if (!tableBody) return;
                
                const announcements = window.APP_DATA.announcements.announcements;
                tableBody.innerHTML = announcements.map((ann, index) => `
                    <tr data-announcement-id="announcement-${index}">
                        <td>${ann.created}</td>
                        <td><span class="bel-badge ${this.getCategoryBadgeClass(ann.category)}">${ann.category}</span></td>
                        <td>${ann.title}</td>
                        <td>${ann.body}</td>
                        <td><a href="${ann.link}" target="_blank" class="referral-id-link">${ann.link}</a></td>
                        <td><button class="bel-btn-s danger announcement-delete-btn" data-announcement-id="announcement-${index}"><i class="fas fa-trash"></i> Delete</button></td>
                    </tr>
                `).join('');
            },

            ensureAnnouncementConfirmModal() {
                if (this.announcementConfirmModalEl) return this.announcementConfirmModalEl;
                
                const wrap = document.createElement('div');
                wrap.className = 'modal-overlay';
                wrap.id = 'announcement-delete-modal';
                wrap.innerHTML = `
                    <div class="modal-content" style="max-width:520px;">
                        <div class="modal-header">
                            <h3 style="margin:0;">Confirm Deletion</h3>
                            <button class="close-button" aria-label="Close">&times;</button>
                        </div>
                        <div style="padding-top:16px;">
                            <p style="line-height:1.6; font-size:0.95rem;">
                                This action <strong>cannot be undone</strong>. Are you sure you want to delete this announcement?
                            </p>
                            <div class="modal-actions" style="margin-top:16px; display:flex; justify-content:flex-end; gap:8px;">
                                <button class="bel-btn danger confirm-announcement-delete-btn">Delete</button>
                                <button class="bel-btn secondary confirm-announcement-cancel-btn">Cancel</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(wrap);
                this.announcementConfirmModalEl = wrap;

                const close = () => this.announcementConfirmModalEl.classList.remove('show');
                this.announcementConfirmModalEl.querySelector('.close-button')?.addEventListener('click', close);
                this.announcementConfirmModalEl.querySelector('.confirm-announcement-cancel-btn')?.addEventListener('click', close);
                this.announcementConfirmModalEl.addEventListener('click', (e) => { 
                    if (e.target === this.announcementConfirmModalEl) close(); 
                });

                // Handle delete confirmation
                this.announcementConfirmModalEl.querySelector('.confirm-announcement-delete-btn')?.addEventListener('click', () => {
                    const announcementId = this.announcementConfirmModalEl.getAttribute('data-announcement-id');
                    this.deleteAnnouncement(announcementId);
                    close();
                });

                return this.announcementConfirmModalEl;
            },

            openAnnouncementConfirmModal(announcementId) {
                const modal = this.ensureAnnouncementConfirmModal();
                modal.setAttribute('data-announcement-id', announcementId);
                modal.style.zIndex = this.getNextModalZIndex();
                modal.classList.add('show');
            },

            deleteAnnouncement(announcementId) {
                const announcementIndex = parseInt(announcementId.replace('announcement-', ''));
                if (window.APP_DATA.announcements.announcements[announcementIndex]) {
                    window.APP_DATA.announcements.announcements.splice(announcementIndex, 1);
                    this.renderAnnouncementsNew();
                    console.log('Announcement deleted successfully');
                }
            },

            setupEventListeners() {
                document.addEventListener('click', (e) => {
                    // Event delegation for announcement delete buttons
                    const announcementDeleteBtn = e.target.closest('.announcement-delete-btn');
                    if (announcementDeleteBtn) {
                        const announcementId = announcementDeleteBtn.getAttribute('data-announcement-id');
                        this.openAnnouncementConfirmModal(announcementId);
                        return;
                    }
                });
            }
        };

        // Initialize test
        document.addEventListener('DOMContentLoaded', () => {
            TestContentManager.setupEventListeners();
            TestContentManager.renderAnnouncementsNew();
            console.log('Test initialization complete');
        });
    </script>
</body>
</html>